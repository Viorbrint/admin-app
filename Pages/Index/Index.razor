@page "/"

<PageTitle>AdminApp</PageTitle>

<AuthorizeView>
<Authorized>
    <section style="background-color: #f5f5f5;">
      <div class="container py-5 min-vh-100">
        <div class="row d-flex justify-content-center align-items-center">
          <div class="col-xl-12">
            <div class="card rounded-3 shadow-sm">
              <div class="card-body p-4">
                @if (users == null)
                {
                    <div class="text-center py-5">
                      <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
                        <span class="visually-hidden">Loading...</span>
                      </div>
                      <p class="mt-3">Loading users, please wait...</p>
                    </div>
                }
                else if (users.Count == 0)
                {
                    <div class="text-center py-5">
                      <p class="text-muted">No users found. Try adjusting your search or adding users.</p>
                    </div>
                }
                else
                {
                    <div class="d-flex justify-content-between align-items-center mb-3">
                      <div>
                        <button class="btn btn-outline-primary me-2" @onclick="BlockSelectedUsers">Block</button>
                        <button class="btn btn-outline-primary me-2" @onclick="UnblockSelectedUsers">Unblock</button>
                        <button class="btn btn-outline-danger" @onclick="DeleteSelectedUsers">Delete</button>
                      </div>
                      <div class="input-group d-flex justify-content-between align-items-center mb-3" style="gap: 0.4em; max-width: 250px;">
                        <input type="text" class="form-control" placeholder="Search..." @bind="FilterQuery" />
                        <button class="btn btn-outline-dark ms-2" @onclick="Logout">Logout</button>
                      </div>
                    </div>

                    <table class="table table-hover align-middle">
                      <thead class="table-light">
                        <tr>
                          <th scope="col"><input type="checkbox" @onclick="SelectAllUsers"></th>
                          <th scope="col">Name</th>
                          <th scope="col">Email</th>
                          <th scope="col">Last Seen</th>
                        </tr>
                      </thead>
                      <tbody>
                        @foreach (var user in users)
                        {
                            <tr class="@GetRowClass(user)" @onclick="@(() => SelectUser(user.Email))">
                              <td><input type="checkbox" @bind="_isSelected[user.Email]"></td>
                              <td>@user.UserName</td>
                              <td>@user.Email</td>
                              <td>@(_lastSeen.ContainsKey(user.Email) ? GetLocalTime(_lastSeen[user.Email]) : "Unknown")</td>
                            </tr>
                        }
                      </tbody>
                    </table>
                  }
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
</Authorized>

<NotAuthorized>
    <section class="container py-5 min-vh-100 text-center">
        <div class="alert alert-danger">
            <h4 class="alert-heading">Access Denied</h4>
            <p>You must be logged in to view this page.</p>
            <a href="/login" class="btn btn-primary">Login</a>
        </div>
    </section>
</NotAuthorized>

</AuthorizeView>
